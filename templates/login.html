<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ورود | Marzban Eye</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-white">
  <div class="min-h-screen flex items-center justify-center">
    <div class="w-full max-w-sm bg-gray-800 p-6 rounded-2xl shadow" x-data="loginForm()">
      <h1 class="text-2xl font-bold text-center mb-6">ورود به پنل</h1>

      <input class="w-full mb-3 p-2 rounded text-black" type="text" placeholder="نام کاربری"
             x-model="username" autofocus>
      <input class="w-full mb-3 p-2 rounded text-black" type="password" placeholder="رمز عبور"
             x-model="password" @keydown.enter="submit">

      <button class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded font-semibold"
              @click="submit">ورود</button>

      <p class="text-red-400 text-center mt-3" x-text="error"></p>
    </div>
  </div>

  <script>
    function loginForm() {
      return {
        username: "",
        password: "",
        error: "",
        submit() {
          fetch('/auth/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `username=${encodeURIComponent(this.username)}&password=${encodeURIComponent(this.password)}`
          })
          .then(r => r.json())
          .then(data => {
            if (data.access_token) {
              localStorage.setItem('token', data.access_token);
              window.location.href = '/dashboard';
            } else {
              this.error = 'نام کاربری یا رمز نادرست است';
            }
          })
          .catch(() => this.error = 'خطا در ارتباط با سرور');
        }
      }
    }
  </script>
</body>
</html>
